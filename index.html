<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Africa interactive map — demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* Layout */

    :root{
  --asu-black: #000000;
  --asu-gold: rgb(255,198,39); /* #FFC627 */
  --asu-maroon: rgb(140,29,64); /* #8C1D40 */
  --line-opacity: 0.04; /* subtle line opacity */
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  color: #222;
  overflow-x: hidden;
}

body {
  margin:0;
  background: transparent;
  color: #fff;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

    /* Countries */
    .country { fill: #6b7280; stroke: #4b5563; stroke-width:0.5; cursor: default; pointer-events: none; transition: fill .12s, stroke .12s; }
    .country.has-data { fill: var(--asu-gold); stroke: rgba(255, 198, 39, 0.4); stroke-width:0.5; cursor: pointer; pointer-events: auto; }
    .country:hover { fill: #4b5563; stroke: #374151; stroke-width:0.7; }
    .country.has-data:hover { fill: rgb(230, 178, 35); stroke: rgba(230, 178, 35, 0.5); stroke-width:0.7; }
    .country.active { fill: #374151; stroke: #1f2937; stroke-width:1.0; }
    .country.has-data.active { fill: rgb(230, 178, 35); stroke: rgba(230, 178, 35, 0.6); stroke-width:1.0; }

/* --- Visualization Title Section --- */
.viz-header {
  text-align: center;
  padding: 20px 20px 10px 20px;
  max-width: 900px;
  margin: 0 auto;
}

.viz-title {
  font-size: clamp(20px, 4vw, 32px);
  font-weight: 600;
  margin: 0;
  letter-spacing: 0.3px;
  color: #fff;
}

.viz-subtitle {
  margin: 8px 0 0 0;
  font-size: clamp(13px, 2vw, 15px);
  color: #aaa;
}

/* Fix map container spacing so top and bottom feel equal */
.map-wrap {
  margin: 0 auto;
  padding: 0;
  max-width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  background: transparent;
  border: none;
  position: relative;
}

    /* Modal overlay (desktop only) */
 #infoOverlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.36);
  z-index: 999;
  overflow: auto;
}

    /* Modal card (desktop) */
.info-card {
  display: none;
  position: fixed;
  z-index: 1000;
  min-width: 260px;
  max-width: 460px;
  width: auto;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 14px 34px rgba(0,0,0,0.22);
  padding: 16px 18px;
  font-size: 14px;
  line-height: 1.35;
  color: #222;
  overflow: auto;
  max-height: calc(100vh - 40px); 
}
    .info-card h3 { margin:0 0 8px 0; font-size:16px; font-weight:600; }
    .info-row { margin:6px 0; display:flex; justify-content:space-between; align-items:center; }
    .info-row div:first-child { color:#444; }
    .close-btn { background:none; border:0; font-size:20px; line-height:1; cursor:pointer; position:absolute; right:8px; top:8px; color:#666; }
    
svg {
  display: block;
  width: 100%;
  height: 100%;
  min-height: 400px;
}
#mapSvg {
  background: transparent;
  cursor: grab;
}
#mapSvg.dragging {
  cursor: grabbing;
}

    .loading {
      position:absolute; left:12px; top:12px; background:transparent; font-size:13px; color:#666;
    }
    
    /* Zoom controls - fixed positioning */
    .zoom-controls {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      z-index: 100;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid rgba(255, 198, 39, 0.15);
      background: rgba(0, 0, 0, 0.5);
    }
    
    .zoom-btn {
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
      transition: all 0.2s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    
    .zoom-btn:hover {
      background: #fff;
      border-color: var(--asu-gold);
      transform: scale(1.05);
    }
    
    .zoom-btn:active {
      transform: scale(0.95);
    }
    
    /* Mobile bottom card */
    .mobile-info-card {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-radius: 16px 16px 0 0;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.25);
      padding: 20px;
      z-index: 1000;
      max-height: 40vh;
      overflow-y: auto;
    }
    
    .mobile-info-card h3 { 
      margin: 0 0 12px 0; 
      font-size: 18px; 
      font-weight: 600; 
      color: #222;
    }
    
    .mobile-info-card .info-row {
      margin: 10px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .mobile-info-card .info-row:last-child {
      border-bottom: none;
    }
    
    .mobile-info-card .info-row div:first-child { 
      color: #666;
      font-size: 14px;
    }
    
    .mobile-info-card .info-row div:last-child { 
      color: #222;
      font-weight: 600;
      font-size: 15px;
    }
    
    .mobile-close-btn {
      background: none;
      border: 0;
      font-size: 24px;
      line-height: 1;
      cursor: pointer;
      position: absolute;
      right: 16px;
      top: 16px;
      color: #666;
      padding: 4px;
    }
    
    /* Mobile-specific styles */
    @media (max-width: 768px) {
      .viz-header {
        padding: 15px 15px 8px 15px;
      }
      
      .info-card {
        display: none !important;
      }
      
      #infoOverlay {
        display: none !important;
      }
      
      .zoom-controls {
        top: 8px;
        right: 8px;
        padding: 6px;
      }
      
      .zoom-btn {
        width: 36px;
        height: 36px;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
    <div class="viz-header">
  <h1 class="viz-title">Higher Education Across Africa</h1>
  <p class="viz-subtitle">Click any country to view population, projections, and university data.</p>
</div>

  <div class="map-wrap" id="mapWrap">
    <div class="loading" id="loadingText">Loading map…</div>
    
    <!-- Zoom controls -->
    <div class="zoom-controls">
      <button class="zoom-btn" id="zoomIn" aria-label="Zoom in">+</button>
      <button class="zoom-btn" id="zoomOut" aria-label="Zoom out">−</button>
      <button class="zoom-btn" id="zoomReset" aria-label="Reset zoom" style="font-size: 16px;">⊙</button>
    </div>
    
    <svg id="mapSvg" viewBox="0 0 960 700" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Map of Africa"></svg>

    <!-- Desktop modal overlay + card -->
    <div id="infoOverlay" role="presentation"></div>
    <div class="info-card" id="infoCard" role="dialog" aria-modal="true" aria-hidden="true">
      <button class="close-btn" id="closeCard" aria-label="Close dialog">&times;</button>
      <h3 id="cardTitle">Country</h3>
      <div class="info-row"><div>Population:</div><div id="popVal">—</div></div>
      <div class="info-row"><div>Projected 2050:</div><div id="projVal">—</div></div>
      <div class="info-row"><div>Universities:</div><div id="uniVal">—</div></div>
      <div class="info-row"><div>Youth %:</div><div id="youthVal">—</div></div>
    </div>
    
    <!-- Mobile bottom card -->
    <div class="mobile-info-card" id="mobileInfoCard">
      <button class="mobile-close-btn" id="mobileCloseCard" aria-label="Close">&times;</button>
      <h3 id="mobileCardTitle">Country</h3>
      <div class="info-row"><div>Population:</div><div id="mobilePopVal">—</div></div>
      <div class="info-row"><div>Projected 2050:</div><div id="mobileProjVal">—</div></div>
      <div class="info-row"><div>Universities:</div><div id="mobileUniVal">—</div></div>
      <div class="info-row"><div>Youth %:</div><div id="mobileYouthVal">—</div></div>
    </div>
  </div>

  <!-- D3 -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <script>
  /********** Configuration **********/
  const geoUrl = "https://raw.githubusercontent.com/LiaScript/GeoJson/master/africa.geo.json";

  const stats = {
    "NGA": { country: "Nigeria", population: "223,804,632", projected2050: "401,000,000", universities: 170, youth_pct: "60%" },
    "EGY": { country: "Egypt", population: "104,258,327", projected2050: "151,000,000", universities: 120, youth_pct: "50%" },
    "ZAF": { country: "South Africa", population: "60,041,994", projected2050: "67,000,000", universities: 125, youth_pct: "43%" }
  };

  /********** Setup DOM nodes & D3 basics **********/
  const mapWrap = document.getElementById("mapWrap");
  const svg = d3.select("#mapSvg");
  const loadingText = document.getElementById("loadingText");

  // Desktop modal elements
  const infoOverlay = d3.select("#infoOverlay");
  const infoCard = d3.select("#infoCard");
  const cardTitle = d3.select("#cardTitle");
  const popVal = d3.select("#popVal");
  const projVal = d3.select("#projVal");
  const uniVal = d3.select("#uniVal");
  const youthVal = d3.select("#youthVal");
  const closeBtn = d3.select("#closeCard");
  
  // Mobile card elements
  const mobileInfoCard = d3.select("#mobileInfoCard");
  const mobileCardTitle = d3.select("#mobileCardTitle");
  const mobilePopVal = d3.select("#mobilePopVal");
  const mobileProjVal = d3.select("#mobileProjVal");
  const mobileUniVal = d3.select("#mobileUniVal");
  const mobileYouthVal = d3.select("#mobileYouthVal");
  const mobileCloseBtn = d3.select("#mobileCloseCard");

  const widthBase = 960, heightBase = 700;
  const projection = d3.geoMercator().center([20, 3]);
  const path = d3.geoPath().projection(projection);

  let countriesGroup = null;
  let africaGeo = null;
  
  // Detect if mobile
  const isMobile = () => window.innerWidth <= 768;
  
  // Zoom behavior with translation limits
  let currentZoom = d3.zoomIdentity;
  const zoomBehavior = d3.zoom()
    .scaleExtent([1, 8])
    .translateExtent([[0, 0], [widthBase, heightBase]])
    .extent([[0, 0], [widthBase, heightBase]])
    .on("zoom", (event) => {
      currentZoom = event.transform;
      countriesGroup.attr("transform", event.transform);
    });

  /********** Load GeoJSON and draw **********/
  d3.json(geoUrl).then(geo => {
    loadingText.style.display = "none";
    africaGeo = geo;

    svg.attr("viewBox", `0 0 ${widthBase} ${heightBase}`);
    countriesGroup = svg.append("g").attr("class", "countries");

    countriesGroup.selectAll("path")
      .data(geo.features)
      .join("path")
        .attr("class", d => {
          const iso = d.properties.ISO_A3 || d.properties.iso_a3 || d.properties.ID || "";
          return stats[iso] ? "country has-data" : "country";
        })
        .attr("d", path)
        .attr("data-name", d => d.properties.ADMIN || d.properties.name || "")
        .attr("data-iso-a3", d => d.properties.ISO_A3 || d.properties.iso_a3 || d.properties.ID || "")
        .on("mouseover", function() { d3.select(this).raise().classed("hover", true); })
        .on("mouseout", function() { d3.select(this).classed("hover", false); })
        .on("click", function(event, d) {
          event.stopPropagation();

          countriesGroup.selectAll(".country").classed("active", false);
          d3.select(this).classed("active", true);

          const iso = d.properties.ISO_A3 || d.properties.iso_a3 || d.properties.ID || "";
          const name = d.properties.ADMIN || d.properties.name || iso;
          const data = stats[iso] || { country: name, population: "N/A", projected2050: "N/A", universities: "N/A", youth_pct: "N/A" };

          if (isMobile()) {
            // Show mobile card at bottom
            mobileCardTitle.text(data.country);
            mobilePopVal.text(data.population);
            mobileProjVal.text(data.projected2050);
            mobileUniVal.text(data.universities);
            mobileYouthVal.text(data.youth_pct);
            mobileInfoCard.style("display", "block");
          } else {
            // Show desktop card near click
            cardTitle.text(data.country);
            popVal.text(data.population);
            projVal.text(data.projected2050);
            uniVal.text(data.universities);
            youthVal.text(data.youth_pct);
            const clientX = event.clientX;
            const clientY = event.clientY;
            showCardAtClient(clientX, clientY);
          }
        });

    svg.call(zoomBehavior);
    
    d3.select("#zoomIn").on("click", () => {
      svg.transition().duration(300).call(zoomBehavior.scaleBy, 1.5);
    });
    
    d3.select("#zoomOut").on("click", () => {
      svg.transition().duration(300).call(zoomBehavior.scaleBy, 0.67);
    });
    
    d3.select("#zoomReset").on("click", () => {
      svg.transition().duration(500).call(zoomBehavior.transform, d3.zoomIdentity);
    });

    fitAndRender();
    window.addEventListener("resize", debounce(fitAndRender, 120));
  }).catch(err => {
    loadingText.textContent = "Failed to load map. Check network / GeoJSON URL.";
    console.error("GeoJSON load error:", err);
  });

  /********** Fit & render helpers **********/
  function fitAndRender() {
    if (!africaGeo) return;
    const margin = 22;
    projection.fitExtent([[margin, margin], [widthBase - margin, heightBase - margin]], africaGeo);
    svg.selectAll("path.country").attr("d", path);
  }

  function debounce(fn, wait) {
    let to;
    return (...args) => {
      clearTimeout(to);
      to = setTimeout(() => fn(...args), wait);
    };
  }

  /********** Modal behavior **********/
  function showCardAtClient(clientX, clientY) {
    infoOverlay.style("display", "block");
    infoCard.style("display", "block").attr("aria-hidden", "false");

    document.documentElement.style.overflow = 'hidden';
    document.body.style.overflow = 'hidden';

    const cw = window.innerWidth;
    const cardNode = infoCard.node();
    const computedW = Math.min(460, Math.max(260, Math.floor(cw * 0.42)));
    infoCard.style("width", computedW + "px");

    requestAnimationFrame(() => {
      const cardW = cardNode.offsetWidth || computedW;
      const cardH = cardNode.offsetHeight || 180;
      let left = clientX + 12;
      let top = clientY + 12;

      if (left + cardW + 12 > cw) left = Math.max(12, clientX - cardW - 12);
      if (top + cardH + 12 > window.innerHeight) top = Math.max(12, clientY - cardH - 12);

      if (top + cardH > window.innerHeight - 6) top = window.innerHeight - cardH - 12;
      if (left + cardW > cw - 6) left = Math.max(12, cw - cardW - 12);
      if (left < 12) left = 12;
      if (top < 12) top = 12;

      infoCard.style("left", left + "px").style("top", top + "px");
      closeBtn.node().focus();
    });
  }
  
  function closeModal() {
    infoOverlay.style("display", "none");
    infoCard.style("display", "none").attr("aria-hidden", "true");
    mobileInfoCard.style("display", "none");
    document.documentElement.style.overflow = '';
    document.body.style.overflow = '';
    if (countriesGroup) countriesGroup.selectAll(".country").classed("active", false);
  }

  infoOverlay.on("click", () => closeModal());
  closeBtn.on("click", () => closeModal());
  mobileCloseBtn.on("click", () => closeModal());

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeModal();
  });

  document.addEventListener("click", (e) => {
    const target = e.target;
    if (infoCard.style("display") === "block") {
      if (!target.closest || (!target.closest(".info-card") && !target.closest(".country"))) closeModal();
    }
  });

  </script>
</body>
</html>