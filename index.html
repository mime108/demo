<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Africa interactive map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --asu-black: #000000;
      --asu-gold: rgb(255,198,39);
      --asu-maroon: rgb(140,29,64);
    }

    * { box-sizing: border-box; }
    
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    body {
      background: transparent;
    }

    #africaMap {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: transparent;
    }

    #africaSvg {
      display: block;
      width: 100%;
      height: 100%;
      background: transparent;
      cursor: grab;
    }

    #africaSvg.dragging {
      cursor: grabbing;
    }

    /* Countries */
    .country {
      fill: #6b7280;
      stroke: #4b5563;
      stroke-width: 0.5;
      cursor: default;
      pointer-events: none;
      transition: fill 0.12s, stroke 0.12s;
      vector-effect: non-scaling-stroke;
    }

    .country.has-data {
      fill: var(--asu-gold);
      stroke: rgba(255, 198, 39, 0.4);
      stroke-width: 0.5;
      cursor: pointer;
      pointer-events: auto;
    }

    .country.has-data:hover {
      fill: rgb(230, 178, 35);
      stroke: rgba(230, 178, 35, 0.5);
      stroke-width: 0.7;
    }

    .country.has-data.active {
      fill: rgb(230, 178, 35);
      stroke: rgba(230, 178, 35, 0.6);
      stroke-width: 1.0;
    }

    /* Zoom controls - always visible */
    .zoom-controls {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      z-index: 100;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid rgba(255, 198, 39, 0.2);
      background: rgba(0, 0, 0, 0.7);
    }

    .zoom-btn {
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
      transition: all 0.2s;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .zoom-btn:hover {
      background: #fff;
      border-color: var(--asu-gold);
      transform: scale(1.05);
    }

    .zoom-btn:active {
      transform: scale(0.95);
    }

    /* Info card */
    #africaCard {
      position: fixed;
      display: none;
      width: 320px;
      max-width: calc(100vw - 20px);
      background: #111;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 12px;
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.35);
      padding: 12px;
      z-index: 1000;
    }

    .cardHead {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    #africaCardTitle {
      font-weight: 700;
      font-size: 15px;
    }

    #africaCardClose {
      width: 30px;
      height: 30px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.10);
      color: #fff;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      flex-shrink: 0;
    }

    #africaCardClose:hover {
      background: rgba(255, 255, 255, 0.16);
    }

    .cardGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .stat {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 10px;
      padding: 8px;
    }

    .lbl {
      font-size: 11px;
      opacity: 0.75;
      margin-bottom: 3px;
    }

    .val {
      font-size: 13px;
      font-weight: 700;
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      #africaCard {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        top: auto;
        width: 100%;
        max-width: 100%;
        border-radius: 16px 16px 0 0;
        max-height: 50vh;
        overflow-y: auto;
      }

      .zoom-controls {
        top: 8px;
        right: 8px;
        padding: 6px;
      }

      .zoom-btn {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div id="africaMap">
    <svg id="africaSvg" aria-label="Africa map"></svg>

    <!-- Zoom controls -->
    <div class="zoom-controls">
      <button class="zoom-btn" id="zoomIn" aria-label="Zoom in">+</button>
      <button class="zoom-btn" id="zoomOut" aria-label="Zoom out">−</button>
      <button class="zoom-btn" id="zoomReset" aria-label="Reset zoom" style="font-size: 16px;">⊙</button>
    </div>

    <!-- Info card -->
    <div id="africaCard" role="dialog" aria-label="Country details">
      <div class="cardHead">
        <div id="africaCardTitle">Country</div>
        <button id="africaCardClose" type="button" aria-label="Close">×</button>
      </div>
      <div class="cardGrid">
        <div class="stat"><div class="lbl">Population</div><div class="val" id="popVal">—</div></div>
        <div class="stat"><div class="lbl">2050 Projection</div><div class="val" id="projVal">—</div></div>
        <div class="stat"><div class="lbl">Universities</div><div class="val" id="uniVal">—</div></div>
        <div class="stat"><div class="lbl">Youth %</div><div class="val" id="youthVal">—</div></div>
      </div>
    </div>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
  (() => {
    const geoUrl = "https://raw.githubusercontent.com/LiaScript/GeoJson/master/africa.geo.json";

    const stats = {
      "NGA": { country: "Nigeria", population: "223,804,632", projected2050: "401,000,000", universities: 170, youth_pct: "60%" },
      "EGY": { country: "Egypt", population: "104,258,327", projected2050: "151,000,000", universities: 120, youth_pct: "50%" },
      "ZAF": { country: "South Africa", population: "60,041,994", projected2050: "67,000,000", universities: 125, youth_pct: "43%" }
    };

    const root = document.getElementById("africaMap");
    const svg = d3.select("#africaSvg");
    const card = document.getElementById("africaCard");
    const closeBtn = document.getElementById("africaCardClose");

    const cardTitle = document.getElementById("africaCardTitle");
    const popVal = document.getElementById("popVal");
    const projVal = document.getElementById("projVal");
    const uniVal = document.getElementById("uniVal");
    const youthVal = document.getElementById("youthVal");

    const widthBase = 960, heightBase = 700;

    const projection = d3.geoMercator().center([20, 3]);
    const path = d3.geoPath(projection);

    let countriesGroup = null;
    const isMobile = () => window.innerWidth <= 768;

    // Zoom behavior
    const zoomBehavior = d3.zoom()
      .scaleExtent([1, 8])
      .translateExtent([[0, 0], [widthBase, heightBase]])
      .extent([[0, 0], [widthBase, heightBase]])
      .on("zoom", (event) => {
        if (countriesGroup) countriesGroup.attr("transform", event.transform);
      });

    svg.call(zoomBehavior);

    // Zoom button handlers
    d3.select("#zoomIn").on("click", () => {
      svg.transition().duration(300).call(zoomBehavior.scaleBy, 1.5);
    });

    d3.select("#zoomOut").on("click", () => {
      svg.transition().duration(300).call(zoomBehavior.scaleBy, 0.67);
    });

    d3.select("#zoomReset").on("click", () => {
      svg.transition().duration(500).call(zoomBehavior.transform, d3.zoomIdentity);
    });

    function hideCard() {
      card.style.display = "none";
      if (countriesGroup) countriesGroup.selectAll(".country").classed("active", false);
    }

    closeBtn.addEventListener("click", hideCard);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") hideCard();
    });

    // Click outside card closes it
    document.addEventListener("click", (e) => {
      if (card.style.display === "none") return;
      if (!card.contains(e.target) && !e.target.closest('.country.has-data')) {
        hideCard();
      }
    });

    function showCardAt(clientX, clientY) {
      card.style.display = "block";

      if (isMobile()) {
        // Mobile: bottom sheet (no positioning needed)
        return;
      }

      // Desktop: position near click
      requestAnimationFrame(() => {
        const cardRect = card.getBoundingClientRect();
        let left = clientX + 12;
        let top = clientY + 12;

        const maxLeft = window.innerWidth - cardRect.width - 12;
        const maxTop = window.innerHeight - cardRect.height - 12;

        if (left > maxLeft) left = Math.max(12, clientX - cardRect.width - 12);
        if (top > maxTop) top = Math.max(12, clientY - cardRect.height - 12);

        left = Math.max(12, Math.min(left, maxLeft));
        top = Math.max(12, Math.min(top, maxTop));

        card.style.left = left + "px";
        card.style.top = top + "px";
      });
    }

    function stripFarSouthIslands(feature, minLatKeep = -38) {
      const p = feature.properties || {};
      const iso = p.ISO_A3 || p.iso_a3 || p.ID || "";

      if (iso !== "ZAF") return feature;

      const g = feature.geometry;
      if (!g) return feature;

      const centroidLat = (polyCoords) => {
        const tmp = { type: "Feature", geometry: { type: "Polygon", coordinates: polyCoords } };
        return d3.geoCentroid(tmp)[1];
      };

      if (g.type === "Polygon") {
        const lat = centroidLat(g.coordinates);
        if (lat < minLatKeep) return null;
        return feature;
      }

      if (g.type === "MultiPolygon") {
        const kept = g.coordinates.filter(polyCoords => centroidLat(polyCoords) >= minLatKeep);
        if (!kept.length) return feature;

        return {
          ...feature,
          geometry: { type: "MultiPolygon", coordinates: kept }
        };
      }

      return feature;
    }

    d3.json(geoUrl).then(rawGeo => {
      const geo = {
        ...rawGeo,
        features: rawGeo.features
          .map(f => stripFarSouthIslands(f, -38))
          .filter(Boolean)
      };

      svg
        .attr("viewBox", `0 0 ${widthBase} ${heightBase}`)
        .attr("preserveAspectRatio", "xMidYMid meet");

      projection.fitExtent([[22, 22], [widthBase - 22, heightBase - 22]], geo);

      countriesGroup = svg.append("g").attr("class", "countries");

      const features = geo.features.map(f => {
        const p = f.properties || {};
        const iso = p.ISO_A3 || p.iso_a3 || p.ID || "";
        const name = p.ADMIN || p.name || iso;
        const hasData = !!stats[iso];
        f.__iso = iso;
        f.__name = name;
        f.__hasData = hasData;
        return f;
      });

      countriesGroup.selectAll("path")
        .data(features)
        .join("path")
        .attr("class", d => d.__hasData ? "country has-data" : "country")
        .attr("d", path)
        .on("mouseover", function(_, d) {
          if (!d.__hasData) return;
          d3.select(this).classed("hover", true);
        })
        .on("mouseout", function(_, d) {
          if (!d.__hasData) return;
          d3.select(this).classed("hover", false);
        })
        .on("click", function(event, d) {
          if (!d.__hasData) return;
          event.stopPropagation();

          countriesGroup.selectAll(".country").classed("active", false);
          d3.select(this).classed("active", true);

          const data = stats[d.__iso];
          cardTitle.textContent = data.country || d.__name;
          popVal.textContent = data.population ?? "N/A";
          projVal.textContent = data.projected2050 ?? "N/A";
          uniVal.textContent = data.universities ?? "N/A";
          youthVal.textContent = data.youth_pct ?? "N/A";

          showCardAt(event.clientX, event.clientY);
        });

    }).catch(console.error);
  })();
  </script>
</body>
</html>