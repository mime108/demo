<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Africa interactive map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --asu-black: #000000;
      --asu-gold: rgb(255,198,39);
      --asu-maroon: rgb(140,29,64);
    }

    * { box-sizing: border-box; }
    
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    body {
      background: transparent;
    }

    #africaMap {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background: transparent;
    }

    #africaSvg {
      display: block;
      width: 100%;
      height: 100%;
      background: transparent;
      cursor: grab;
    }

    #africaSvg.dragging {
      cursor: grabbing;
    }

    /* Countries */
    .country {
      fill: #6b7280;
      stroke: #4b5563;
      stroke-width: 0.5;
      cursor: default;
      pointer-events: none;
      transition: fill 0.12s, stroke 0.12s;
      vector-effect: non-scaling-stroke;
    }

    .country.has-data {
      fill: var(--asu-gold);
      stroke: rgba(255, 198, 39, 0.4);
      stroke-width: 0.5;
      cursor: pointer;
      pointer-events: auto;
    }

    .country.has-data:hover {
      fill: rgb(230, 178, 35);
      stroke: rgba(230, 178, 35, 0.5);
      stroke-width: 0.7;
    }

    .country.has-data.active {
      fill: rgb(230, 178, 35);
      stroke: rgba(230, 178, 35, 0.6);
      stroke-width: 1.0;
    }

    /* Zoom controls - always visible */
    .zoom-controls {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      z-index: 100;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid rgba(255, 198, 39, 0.2);
      background: rgba(0, 0, 0, 0.7);
    }

    .zoom-btn {
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
      transition: all 0.2s;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .zoom-btn:hover {
      background: #fff;
      border-color: var(--asu-gold);
      transform: scale(1.05);
    }

    .zoom-btn:active {
      transform: scale(0.95);
    }

    /* Source attribution */
    .source-box {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 11px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      z-index: 50;
      max-width: calc(100% - 20px);
    }

    .source-box strong {
      font-weight: 600;
      margin-right: 4px;
    }

    .source-box a {
      color: var(--asu-maroon);
      text-decoration: none;
    }

    .source-box a:hover {
      text-decoration: underline;
    }

    /* Info card - Desktop */
    #africaCard {
      position: fixed;
      display: none;
      width: 340px;
      max-width: calc(100vw - 20px);
      background: Canvas;
      color: CanvasText;
      border: 1px solid rgba(0, 0, 0, 0.15);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      padding: 20px;
      z-index: 1000;
      visibility: hidden;
    }
    
    #africaCard.show {
      visibility: visible;
    }

    .cardHead {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    #africaCardTitle {
      font-weight: 700;
      font-size: 18px;
      color: CanvasText;
    }

    #africaCardClose {
      width: 32px;
      height: 32px;
      border: 1px solid rgba(0, 0, 0, 0.15);
      border-radius: 8px;
      background: transparent;
      color: CanvasText;
      cursor: pointer;
      font-size: 20px;
      line-height: 1;
      flex-shrink: 0;
      transition: background 0.2s;
    }

    #africaCardClose:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    .cardGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .stat {
      background: rgba(0, 0, 0, 0.03);
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 8px;
      padding: 12px;
    }

    .lbl {
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 6px;
      font-weight: 500;
      color: CanvasText;
    }

    .val {
      font-size: 15px;
      font-weight: 700;
      color: CanvasText;
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      #africaMap {
        overflow-y: scroll;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
      }

      #africaSvg {
        cursor: default;
      }
      
      /* Hide zoom controls and source on mobile */
      .zoom-controls,
      .source-box {
        display: none;
      }

      #africaCard {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        max-width: 100%;
        max-height: 100%;
        border-radius: 0;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        padding: 60px 20px 32px 20px;
        border: none;
        flex-direction: column;
        visibility: hidden;
        display: flex;
      }
      
      #africaCard.show {
        visibility: visible;
      }

      .cardHead {
        margin-bottom: 24px;
        padding-bottom: 16px;
        flex-shrink: 0;
        position: sticky;
        top: 0;
        background: Canvas;
        z-index: 10;
        margin-top: -36px;
        padding-top: 36px;
      }

      #africaCardTitle {
        font-size: 24px;
      }

      #africaCardClose {
        width: 40px;
        height: 40px;
        font-size: 24px;
      }

      .cardGrid {
        gap: 16px;
        flex: 1;
        align-content: start;
        padding-bottom: 40px;
      }

      .stat {
        padding: 18px;
      }

      .lbl {
        font-size: 14px;
        margin-bottom: 10px;
      }

      .val {
        font-size: 20px;
      }

      /* Hide map elements when card is open on mobile */
      #africaMap.card-open #africaSvg {
        display: none;
      }

      #africaMap.card-open {
        overflow: hidden;
      }
    }

    /* Very small mobile phones */
    @media (max-width: 375px) {
      .cardGrid {
        grid-template-columns: 1fr;
      }
      
      #africaCard {
        padding: 20px 16px 28px 16px;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      #africaCard {
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      }

      .source-box {
        background: rgba(30, 30, 30, 0.95);
        color: #e0e0e0;
      }

      .source-box a {
        color: var(--asu-gold);
      }
    }
  </style>
</head>
<body>
  <div id="africaMap">
    <svg id="africaSvg" aria-label="Africa map"></svg>

    <!-- Zoom controls -->
    <div class="zoom-controls">
      <button class="zoom-btn" id="zoomIn" aria-label="Zoom in">+</button>
      <button class="zoom-btn" id="zoomOut" aria-label="Zoom out">−</button>
      <button class="zoom-btn" id="zoomReset" aria-label="Reset zoom" style="font-size: 16px;">⊙</button>
    </div>

    <!-- Source attribution -->
    <div class="source-box">
      <strong>Source:</strong> <span id="sourceText">UN Population Data, UNESCO</span>
    </div>

    <!-- Info card -->
    <div id="africaCard" role="dialog" aria-label="Country details">
      <div class="cardHead">
        <div id="africaCardTitle">Country</div>
        <button id="africaCardClose" type="button" aria-label="Close">×</button>
      </div>
      <div class="cardGrid">
        <div class="stat"><div class="lbl">Population</div><div class="val" id="popVal">—</div></div>
        <div class="stat"><div class="lbl">2050 Projection</div><div class="val" id="projVal">—</div></div>
        <div class="stat"><div class="lbl">Universities</div><div class="val" id="uniVal">—</div></div>
        <div class="stat"><div class="lbl">Youth %</div><div class="val" id="youthVal">—</div></div>
      </div>
    </div>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
  (() => {
    const geoUrl = "https://raw.githubusercontent.com/LiaScript/GeoJson/master/africa.geo.json";

    const stats = {
      "NGA": { country: "Nigeria", population: "223,804,632", projected2050: "401,000,000", universities: 170, youth_pct: "60%" },
      "EGY": { country: "Egypt", population: "104,258,327", projected2050: "151,000,000", universities: 120, youth_pct: "50%" },
      "ZAF": { country: "South Africa", population: "60,041,994", projected2050: "67,000,000", universities: 125, youth_pct: "43%" }
    };

    const dataSources = "UN Population Data, UNESCO";
    document.getElementById("sourceText").textContent = dataSources;

    const root = document.getElementById("africaMap");
    const svg = d3.select("#africaSvg");
    const card = document.getElementById("africaCard");
    const closeBtn = document.getElementById("africaCardClose");

    const cardTitle = document.getElementById("africaCardTitle");
    const popVal = document.getElementById("popVal");
    const projVal = document.getElementById("projVal");
    const uniVal = document.getElementById("uniVal");
    const youthVal = document.getElementById("youthVal");

    const projection = d3.geoMercator().center([20, 3]);
    const path = d3.geoPath(projection);

    let countriesGroup = null;
    let geoData = null;
    let zoomBehavior = null;
    
    const isMobile = () => window.innerWidth <= 768;

    function getDimensions() {
      const rect = svg.node().getBoundingClientRect();
      return { width: rect.width, height: rect.height };
    }

    function updateProjectionAndZoom() {
      if (!geoData) return;
      
      const { width, height } = getDimensions();
      const padding = 22;

      // Update projection to fit current container size
      projection.fitExtent([[padding, padding], [width - padding, height - padding]], geoData);

      // Recreate zoom behavior with dynamic extents
      if (zoomBehavior) {
        svg.on(".zoom", null); // Remove old zoom
      }

      zoomBehavior = d3.zoom()
        .scaleExtent([1, 8])
        .translateExtent([[0, 0], [width, height]])
        .extent([[0, 0], [width, height]])
        .on("zoom", (event) => {
          if (countriesGroup) countriesGroup.attr("transform", event.transform);
        });

      svg.call(zoomBehavior);

      // Update viewBox
      svg.attr("viewBox", `0 0 ${width} ${height}`);

      // Redraw paths with new projection
      if (countriesGroup) {
        countriesGroup.selectAll("path").attr("d", path);
      }
    }

    // Zoom button handlers
    d3.select("#zoomIn").on("click", () => {
      svg.transition().duration(300).call(zoomBehavior.scaleBy, 1.5);
    });

    d3.select("#zoomOut").on("click", () => {
      svg.transition().duration(300).call(zoomBehavior.scaleBy, 0.67);
    });

    d3.select("#zoomReset").on("click", () => {
      svg.transition().duration(500).call(zoomBehavior.transform, d3.zoomIdentity);
    });

    function hideCard() {
      card.classList.remove("show");
      setTimeout(() => {
        card.style.display = "none";
      }, 50);
      root.classList.remove("card-open");
      if (countriesGroup) countriesGroup.selectAll(".country").classed("active", false);
    }

    closeBtn.addEventListener("click", hideCard);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") hideCard();
    });

    document.addEventListener("click", (e) => {
      if (card.style.display === "none") return;
      if (!card.contains(e.target) && !e.target.closest('.country.has-data')) {
        hideCard();
      }
    });

    function showCardAt(clientX, clientY) {
      card.style.display = "block";
      
      requestAnimationFrame(() => {
        card.classList.add("show");
      });

      if (isMobile()) {
        root.classList.add("card-open");
        return;
      }

      root.classList.remove("card-open");
      requestAnimationFrame(() => {
        const cardRect = card.getBoundingClientRect();
        let left = clientX + 12;
        let top = clientY + 12;

        const maxLeft = window.innerWidth - cardRect.width - 12;
        const maxTop = window.innerHeight - cardRect.height - 12;

        if (left > maxLeft) left = Math.max(12, clientX - cardRect.width - 12);
        if (top > maxTop) top = Math.max(12, clientY - cardRect.height - 12);

        left = Math.max(12, Math.min(left, maxLeft));
        top = Math.max(12, Math.min(top, maxTop));

        card.style.left = left + "px";
        card.style.top = top + "px";
      });
    }

    function stripFarSouthIslands(feature, minLatKeep = -38) {
      const p = feature.properties || {};
      const iso = p.ISO_A3 || p.iso_a3 || p.ID || "";

      if (iso !== "ZAF") return feature;

      const g = feature.geometry;
      if (!g) return feature;

      const centroidLat = (polyCoords) => {
        const tmp = { type: "Feature", geometry: { type: "Polygon", coordinates: polyCoords } };
        return d3.geoCentroid(tmp)[1];
      };

      if (g.type === "Polygon") {
        const lat = centroidLat(g.coordinates);
        if (lat < minLatKeep) return null;
        return feature;
      }

      if (g.type === "MultiPolygon") {
        const kept = g.coordinates.filter(polyCoords => centroidLat(polyCoords) >= minLatKeep);
        if (!kept.length) return feature;

        return {
          ...feature,
          geometry: { type: "MultiPolygon", coordinates: kept }
        };
      }

      return feature;
    }

    // Resize handler with debouncing
    let resizeTimeout;
    window.addEventListener("resize", () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        updateProjectionAndZoom();
      }, 150);
    });

    d3.json(geoUrl).then(rawGeo => {
      geoData = {
        ...rawGeo,
        features: rawGeo.features
          .map(f => stripFarSouthIslands(f, -38))
          .filter(Boolean)
      };

      svg.attr("preserveAspectRatio", "xMidYMid meet");

      countriesGroup = svg.append("g").attr("class", "countries");

      const features = geoData.features.map(f => {
        const p = f.properties || {};
        const iso = p.ISO_A3 || p.iso_a3 || p.ID || "";
        const name = p.ADMIN || p.name || iso;
        const hasData = !!stats[iso];
        f.__iso = iso;
        f.__name = name;
        f.__hasData = hasData;
        return f;
      });

      countriesGroup.selectAll("path")
        .data(features)
        .join("path")
        .attr("class", d => d.__hasData ? "country has-data" : "country")
        .attr("d", path)
        .on("mouseover", function(_, d) {
          if (!d.__hasData) return;
          d3.select(this).classed("hover", true);
        })
        .on("mouseout", function(_, d) {
          if (!d.__hasData) return;
          d3.select(this).classed("hover", false);
        })
        .on("click", function(event, d) {
          if (!d.__hasData) return;
          event.stopPropagation();

          countriesGroup.selectAll(".country").classed("active", false);
          d3.select(this).classed("active", true);

          const data = stats[d.__iso];
          cardTitle.textContent = data.country || d.__name;
          popVal.textContent = data.population ?? "N/A";
          projVal.textContent = data.projected2050 ?? "N/A";
          uniVal.textContent = data.universities ?? "N/A";
          youthVal.textContent = data.youth_pct ?? "N/A";

          showCardAt(event.clientX, event.clientY);
        });

      // Initial setup
      updateProjectionAndZoom();

    }).catch(console.error);
  })();
  </script>
</body>
</html>